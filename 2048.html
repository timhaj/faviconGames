<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Favicon 2048</title>
    <link id="favicon" rel="icon" type="image/png" sizes="16x16">
    <style>
        body { text-align: center; font-family: Arial, sans-serif; }
        table { margin: 10px auto; border-collapse: collapse; }
        td, th { border: 1px solid black; padding: 5px; text-align: center; }
    </style>
</head>
<body>
    <h1>2048 in Favicon!</h1>
    <p>Use W, A, S, D to move the tiles.</p>
    <p>Score: <span id="score">0</span></p>
    <table>
        <tr><th>Value</th><th>Color</th></tr>
        <tr><td>2</td><td style="background: rgb(10, 245, 0);">&nbsp;</td></tr>
        <tr><td>4</td><td style="background: rgb(20, 235, 0);">&nbsp;</td></tr>
        <tr><td>8</td><td style="background: rgb(40, 215, 0);">&nbsp;</td></tr>
        <tr><td>16</td><td style="background: rgb(60, 195, 0);">&nbsp;</td></tr>
        <tr><td>32</td><td style="background: rgb(80, 175, 0);">&nbsp;</td></tr>
        <tr><td>64</td><td style="background: rgb(100, 155, 0);">&nbsp;</td></tr>
        <tr><td>128</td><td style="background: rgb(120, 135, 0);">&nbsp;</td></tr>
        <tr><td>256</td><td style="background: rgb(140, 115, 0);">&nbsp;</td></tr>
        <tr><td>512</td><td style="background: rgb(160, 95, 0);">&nbsp;</td></tr>
        <tr><td>1024</td><td style="background: rgb(180, 75, 0);">&nbsp;</td></tr>
        <tr><td>2048</td><td style="background: rgb(200, 55, 0);">&nbsp;</td></tr>
    </table>
    <script>
        const canvas = document.createElement("canvas");
        canvas.width = canvas.height = 16;
        const ctx = canvas.getContext("2d");
        const favicon = document.getElementById("favicon");
        const scoreDisplay = document.getElementById("score");
        
        let grid = Array(16).fill(0);
        let score = 0;
        
        function resetGame() {
            grid.fill(0);
            score = 0;
            spawnTile();
            spawnTile();
            updateFavicon();
        }
        
        function spawnTile() {
            let emptyCells = grid.map((v, i) => (v === 0 ? i : -1)).filter(i => i !== -1);
            if (emptyCells.length > 0) {
                let randomIndex = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                grid[randomIndex] = Math.random() < 0.6 ? 2 : 4;
            }
        }
        
        function move(direction) {
            let newGrid = Array(16).fill(0);
            let merged = Array(16).fill(false);
            let moved = false;
            
            const getIndex = (r, c) => (direction === "w" ? c * 4 + r :
                                        direction === "s" ? (3 - c) * 4 + r :
                                        direction === "a" ? r * 4 + c :
                                        r * 4 + (3 - c));
            
            for (let r = 0; r < 4; r++) {
                let line = [];
                for (let c = 0; c < 4; c++) {
                    let value = grid[getIndex(r, c)];
                    if (value !== 0) line.push(value);
                }
                
                for (let i = 0; i < line.length - 1; i++) {
                    if (line[i] === line[i + 1] && !merged[getIndex(r, i)] && !merged[getIndex(r, i + 1)]) {
                        line[i] *= 2;
                        score += line[i];
                        line.splice(i + 1, 1);
                        merged[getIndex(r, i)] = true;
                        if (line[i] === 2048) {
                            alert("You win!");
                            resetGame();
                            return;
                        }
                    }
                }
                
                for (let c = 0; c < line.length; c++) {
                    newGrid[getIndex(r, c)] = line[c];
                    if (grid[getIndex(r, c)] !== newGrid[getIndex(r, c)]) moved = true;
                }
            }
            
            if (moved) {
                grid = newGrid;
                spawnTile();
                updateFavicon();
                scoreDisplay.textContent = score;
            }
            checkLoss();
        }
        
        function checkLoss() {
            if (!grid.includes(0)) {
                let movesPossible = false;
                for (let i = 0; i < 16; i++) {
                    let r = Math.floor(i / 4), c = i % 4;
                    if ((c < 3 && grid[i] === grid[i + 1]) || (r < 3 && grid[i] === grid[i + 4])) {
                        movesPossible = true;
                        break;
                    }
                }
                if (!movesPossible) resetGame();
            }
        }
        
        function updateFavicon() {
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, 16, 16);
            
            for (let i = 0; i < 16; i++) {
                if (grid[i] !== 0) {
                    ctx.fillStyle = `rgb(${Math.min(grid[i] * 5, 255)}, ${255 - Math.min(grid[i] * 5, 255)}, 0)`;
                    ctx.fillRect((i % 4) * 4, Math.floor(i / 4) * 4, 4, 4);
                }
            }
            
            favicon.href = canvas.toDataURL("image/png");
        }
        
        document.addEventListener("keydown", (e) => {
            if (["w", "a", "s", "d"].includes(e.key)) move(e.key);
        });
        
        resetGame();
    </script>
</body>
</html>
